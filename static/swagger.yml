openapi: 3.0.0
info:
  title: Guesthouse Safety API
  description: API for assessing and improving safety of guesthouses in Tunisia
  version: 1.0.0
  contact:
    name: API Support

servers:
  - url: http://localhost:5000
    description: Development server

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

paths:
  /api/auth/signup:
    post:
      tags:
        - Authentication
      summary: Register a new owner account
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
                - email
                - password
              properties:
                name:
                  type: string
                  example: "Ahmed Ben Salah"
                email:
                  type: string
                  example: "ahmed@example.com"
                password:
                  type: string
                  example: "securepass123"
      responses:
        '201':
          description: Account created successfully
        '400':
          description: Invalid input or email already exists

  /api/auth/login:
    post:
      tags:
        - Authentication
      summary: Login and receive JWT token
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - password
              properties:
                email:
                  type: string
                  example: "ahmed@example.com"
                password:
                  type: string
                  example: "securepass123"
      responses:
        '200':
          description: Login successful, returns JWT token
        '401':
          description: Invalid credentials

  /api/auth/me:
    get:
      tags:
        - Authentication
      summary: Get current owner information
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Owner information
        '404':
          description: Owner not found

  /api/guesthouses:
    post:
      tags:
        - Guesthouses
      summary: Create a new guesthouse
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
                - address
                - latitude
                - longitude
                - construction_year
                - number_of_floors
                - number_of_rooms
              properties:
                name:
                  type: string
                  example: "Dar El Medina"
                address:
                  type: string
                  example: "15 Rue de la Kasbah, Tunis"
                latitude:
                  type: number
                  example: 36.8065
                longitude:
                  type: number
                  example: 10.1815
                construction_year:
                  type: integer
                  example: 2010
                number_of_floors:
                  type: integer
                  example: 2
                number_of_rooms:
                  type: integer
                  example: 5
                fire_extinguishers:
                  type: integer
                  example: 2
                smoke_detectors:
                  type: integer
                  example: 4
                emergency_exits:
                  type: integer
                  example: 2
                has_first_aid_kit:
                  type: boolean
                  example: true
                has_stair_handrails:
                  type: boolean
                  example: true
                stairs_slip_resistant:
                  type: boolean
                  example: false
      responses:
        '201':
          description: Guesthouse created successfully
        '400':
          description: Invalid input

    get:
      tags:
        - Guesthouses
      summary: List all guesthouses owned by current user
      security:
        - bearerAuth: []
      responses:
        '200':
          description: List of guesthouses

  /api/guesthouses/{id}:
    get:
      tags:
        - Guesthouses
      summary: Get guesthouse details
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Guesthouse details
        '404':
          description: Guesthouse not found

    put:
      tags:
        - Guesthouses
      summary: Update guesthouse information
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                fire_extinguishers:
                  type: integer
                smoke_detectors:
                  type: integer
      responses:
        '200':
          description: Guesthouse updated successfully
        '404':
          description: Guesthouse not found

    delete:
      tags:
        - Guesthouses
      summary: Delete a guesthouse
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Guesthouse deleted successfully
        '404':
          description: Guesthouse not found

  /api/guesthouses/{id}/safety-assessment:
    get:
      tags:
        - Safety Assessment
      summary: Get comprehensive safety assessment
      description: Returns baseline safety score, weather risks, nearby facilities analysis, recommendations, and cost estimates
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          description: Guesthouse ID
      responses:
        '200':
          description: Complete safety assessment with recommendations and costs
          content:
            application/json:
              schema:
                type: object
                properties:
                  guesthouse_id:
                    type: integer
                  guesthouse_name:
                    type: string
                  assessment_date:
                    type: string
                  scores:
                    type: object
                  issues_identified:
                    type: array
                    items:
                      type: string
                  recommendations:
                    type: object
                  cost_to_improve:
                    type: object
                  explanation:
                    type: string
        '404':
          description: Guesthouse not found
        '403':
          description: Not authorized